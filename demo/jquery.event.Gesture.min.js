!function(a){function v(b,c){if(b&&a.isArray(b)){for(var d=b.length-1;d>0;d--)if(this[d]===c)return!1;return b.push(c),!0}return!1}function w(a,b){for(var d=this.length-1;d>0;d--)this[d]===b&&this.splice(d,1)}var f,g,h,i,j,k,l,q,s,t,u,b=a.event.special,c=!1,d=!1,e=[],m={namespaceBindMap:{},ignore_class:":input",mousePinchMultiplier:1,touchPinchMultiplier:4,tapRadius:3,tap_time:200,held_tap_time:300,swipe_active_radius:50,swipe_passive_radius:20,fling_delta:.7},n={},o=-1,p="GestureAPI",r=[];q={setup:function(b,c){var h,i,n,o,f=a(this),g={};if(!a.data(this,p)){h={},a.extend(!0,h,m),a.data(this,p,h),o=c,o.length&&""!==o[0]||(o=["000"]);for(var q=0;q<o.length;q++)i=o[q],i&&(g.hasOwnProperty(i)||(g[i]=!0,n="._Gesture_"+i,f.bind("mousedown"+n,j),f.bind("touchstart"+n,k),f.bind("mousewheel"+n,l)));v(r,this),d||(a(document).bind("mousemove._Gesture_ mouseup._Gesture_",j),a(document).bind("touchmove._Gesture_ touchcancel._Gesture_ touchend._Gesture_",k),d=!0)}},add:function(b){var f,g,h,c=a.data(this,p),d=b.namespace,e=b.type;if(c&&(f=c.namespaceBindMap,f[e]||(f[e]={}),d)){g=d.split(".");for(var i=0;i<g.length;i++)h=g[i],f[e][h]=!0}},remove:function(b){var g,h,c=a.data(this,p),d=c.namespaceBindMap,e=b.type,f=b.namespace;if(d[e]){if(!f)return delete d[e],void 0;g=f.split(".");for(var i=0;i<g.length;i++)h=g[i],d[e][h]&&delete d[e][h];a.isEmptyObject(d[e])&&delete d[e]}},teardown:function(b){var g,h,i,c=a(this),e=a.data(this,p),f=e.namespaceBindMap;if(a.isEmptyObject(f)){i=b,v(i,"000");for(var j=0;j<i.length;j++)g=i[j],g&&(h="._Gesture_"+g,c.unbind("mousedown"+h),c.unbind("touchstart"+h),c.unbind("mousewheel"+h));a.removeData(this,p),w(r,this),0===r.length&&(a(document).unbind("mousemove._Gesture_"),a(document).unbind("touchmove._Gesture_"),a(document).unbind("mouseup._Gesture_"),a(document).unbind("touchend._Gesture_"),a(document).unbind("touchcancel._Gesture_"),d=!1)}}},f=function(b){var e,c=+new Date,d=b.motion_map;delete d.idto_tapheld,d.allowTap&&(d.endX=d.startX,d.endY=d.startY,d.ms_timestop=c,d.ms_elapsed=c-d.ms_timestart,b.namespaceBindMap.hold&&(e=a.Event("hold"),a.extend(e,d),a(d.boundElement).trigger(e)),delete n[b.motion_id])},g=function(b){var l,m,o,q,r,c=b.motion_id,d=b.sourceEvent,g=b.shiftHeld,h=a.data(b.elem,p),i=h.namespaceBindMap,j=a(d.target),k=!1;if(!n[c]&&(!g||i.pinchStart||i.pinch)&&!j.is(h.ignore_class)){for(o=i.tap||i.hold?!0:!1,q=i.swipeLeft||i.swipeRight||i.swipeUp||i.swipeDown||i.flingLeft||i.flingRight||i.flingUp||i.flingDown?!0:!1,m=e.pop();m;)j.is(m.selector_str)||a(b.elem).is(m.selector_str)?m.callback_match&&m.callback_match(b):m.callback_nomatch&&m.callback_nomatch(b),m=e.pop();return l={allowTap:o,allowSwipe:q,boundElement:b.elem,elem_target:d.target,ms_elapsed:0,ms_timestart:d.timeStamp,ms_timestop:void 0,option_map:h,orig_target:d.target,currentX:d.clientX,currentY:d.clientY,endX:void 0,endY:void 0,startX:d.clientX,startY:d.clientY,timeStamp:d.timeStamp},n[c]=l,(i.pinchStart||i.pinch)&&(g?s=c:t?u||(u=c,k=!0):t=c,k)?(i.pinchStart&&(r=a.Event("pinchStart"),l.pinchDelta=0,a.extend(r,l),a(l.boundElement).trigger(r)),i.pinch&&(r=a.Event("pinch"),l.pinchDelta=0,a.extend(r,l),a(l.boundElement).trigger(r)),void 0):(i.hold&&(l.idto_tapheld=setTimeout(function(){f({motion_id:c,motion_map:l,namespaceBindMap:i})},h.held_tap_time)),void 0)}},h=function(b){var f,g,h,i,j,k,l,m,c=b.motion_id,d=b.sourceEvent,e=!1;if(n[c]){if(f=n[c],g=f.option_map,h=g.namespaceBindMap,f.timeStamp=d.timeStamp,f.elem_target=d.target,f.ms_elapsed=d.timeStamp-f.ms_timestart,f.deltaX=d.clientX-f.currentX,f.deltaY=d.clientY-f.currentY,f.currentX=d.clientX,f.currentY=d.clientY,f.timeStamp=d.timeStamp,f.allowTap&&(Math.abs(f.deltaX)>g.tapRadius||Math.abs(f.deltaY)>g.tapRadius||f.ms_elapsed>g.tap_time)&&(f.allowTap=!1),f.allowSwipe){var p=f.currentX-f.startX,q=f.currentY-f.startY,r=Math.abs(p),v=Math.abs(q);if(r+v>g.swipe_active_radius){var w=r>v?r/f.ms_elapsed:v/f.ms_elapsed,x=r>v?p>0?0:1:q>0?2:3;switch(x){default:case 0:v<g.swipe_passive_radius&&(w>g.fling_delta&&h.flingRight?(i=a.Event("flingRight"),a.extend(i,f),a(f.boundElement).trigger(i)):h.swipeRight&&(i=a.Event("swipeRight"),a.extend(i,f),a(f.boundElement).trigger(i))),f.allowSwipe=!1;break;case 1:v<g.swipe_passive_radius&&(w>g.fling_delta&&h.flingLeft?(i=a.Event("flingLeft"),a.extend(i,f),a(f.boundElement).trigger(i)):h.swipeLeft&&(i=a.Event("swipeLeft"),a.extend(i,f),a(f.boundElement).trigger(i))),f.allowSwipe=!1;break;case 2:r<g.swipe_passive_radius&&(w>g.fling_delta&&h.flingDown?(i=a.Event("flingDown"),a.extend(i,f),a(f.boundElement).trigger(i)):h.swipeDown&&(i=a.Event("swipeDown"),a.extend(i,f),a(f.boundElement).trigger(i))),f.allowSwipe=!1;break;case 3:v<g.swipe_passive_radius&&(w>g.fling_delta&&h.flingUp?(i=a.Event("flingUp"),a.extend(i,f),a(f.boundElement).trigger(i)):h.swipeUp&&(i=a.Event("swipeUp"),a.extend(i,f),a(f.boundElement).trigger(i))),f.allowSwipe=!1}}}return t&&u&&(c===t||c===u)?(n[c]=f,l=n[t],m=n[u],j=Math.floor(Math.sqrt(Math.pow(l.currentX-m.currentX,2)+Math.pow(l.currentY-m.currentY,2))+.5),k=-1===o?0:(j-o)*g.touchPinchMultiplier,o=j,e=!0):s===c&&(h.pinchMove||h.pinch)&&(k=f.deltaY*g.mousePinchMultiplier,e=!0),e?(h.pinchMove&&(i=a.Event("pinchMove"),f.pinchDelta=k,a.extend(i,f),a(f.boundElement).trigger(i)),h.pinch&&(i=a.Event("pinch"),f.pinchDelta=k,a.extend(i,f),a(f.boundElement).trigger(i)),void 0):void 0}},i=function(b){var g,h,i,j,d=b.motion_id,e=b.sourceEvent,f=!1;c=!1,n[d]&&(g=n[d],h=g.option_map,i=h.namespaceBindMap,g.elem_target=e.target,g.ms_elapsed=e.timeStamp-g.ms_timestart,g.ms_timestop=e.timeStamp,g.currentX&&(g.deltaX=e.clientX-g.currentX,g.deltaY=e.clientY-g.currentY),g.currentX=e.clientX,g.currentY=e.clientY,g.endX=e.clientX,g.endY=e.clientY,g.timeStamp=e.timeStamp,g.idto_tapheld&&(clearTimeout(g.idto_tapheld),delete g.idto_tapheld),i.tap&&g.ms_elapsed<=h.tap_time&&g.allowTap&&(j=a.Event("tap"),a.extend(j,g),a(g.boundElement).trigger(j)),d===s?(f=!0,s=void 0):d===t&&(u?(t=u,u=void 0,f=!0):t=void 0,o=-1),d===u&&(u=void 0,o=-1,f=!0),f&&(i.pinchEnd||i.pinch)&&(i.pinchEnd&&(j=a.Event("pinchEnd"),g.pinchDelta=0,a.extend(j,g),a(g.boundElement).trigger(j)),i.pinch&&(j=a.Event("pinch"),g.pinchDelta=0,a.extend(j,g),a(g.boundElement).trigger(j))),delete n[d])},k=function(a){var e,f,j,b=+new Date,d=a.originalEvent.changedTouches||[];switch(c=!0,a.timeStamp=b,a.type){case"touchstart":j=g;break;case"touchmove":j=h,a.preventDefault();break;case"touchend":case"touchcancel":j=i;break;default:return}if(j)for(var k=0;k<d.length;k++)e=d[k],f="touch"+String(e.identifier),a.clientX=e.clientX,a.clientY=e.clientY,j({elem:this,motion_id:f,sourceEvent:a})},j=function(a){var e,b="mouse"+String(a.button),d=!1;if(c)return a.stopImmediatePropagation(),void 0;if(a.shiftKey&&(d=!0),"mousemove"!==a.type&&0!==a.button)return!0;switch(a.type){case"mousedown":e=g;break;case"mouseup":e=i;break;case"mousemove":e=h,a.preventDefault();break;default:return}e&&e({elem:this,sourceEvent:a,shiftHeld:d,motion_id:b})},b.swipeRight=b.swipeLeft=b.swipeUp=b.swipeDown=b.flingRight=b.flingLeft=b.flingUp=b.flingDown=b.pinchStart=b.pinchMove=b.pinchEnd=b.rotateStart=b.rotateMove=b.rotateEnd=b.tap=b.hold=b.pinch=b.rotate=q}(jQuery);